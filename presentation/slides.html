<!DOCTYPE html>
<html>
    <head>
        <title>Use functions for a greater good</title>
        <meta charset="utf-8">
        <style>
         @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
         @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
         @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

         body { font-family: 'Droid Serif'; }
         h1, h2, h3 {
             font-family: 'Yanone Kaffeesatz';
             font-weight: normal;
         }
         .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }

         blockquote {
             border-left: 0.3em solid rgba(0,0,0,0.5);
             padding: 0 15px;
             font-style: italic;
         }

         .left-column-20 {
             color: #777;
             width: 20%;
             height: 92%;
             float: left;
         }
         .left-column-20 h2:last-of-type, .left-column-20 h3:last-child {
             color: #000;
         }
         .right-column-75 {
             width: 75%;
             float: right;
             padding-top: 1em;
         }

         .left-column {
             color: #777;
             width: 50%;
             height: 100%;
             float: left;
         }
         .left-column h2:last-of-type, .left-column h3:last-child {
             color: #000;
         }
         .right-column {
             width: 50%;
             height: 100%;
             float: right;
             padding-top: 1em;
         }

        </style>
    </head>
    <body>
        <textarea id="source">
# Is OOP the Holly Grail?

# Some promises of OOP

Reuse - OOP makes programming faster and easier because of the reuse of existing, previously tested classes from a library.  Reuse can also be accomplished by inheritance.

--

# Code Reuse

> Reusability has been difficult to achieve on early object-oriented projects because class libraries are not inherently very reusable. Searching through a class library, and understanding the details of code used to build the classes, can often cost more than rebuilding the classes from scratch."
>
> <footer>
            - <cite>The Object Technology Architecture: Business Objects for Corporate Information Systems
            Business Object Design and Implementation: OOPSLA ’95 Workshop Proceedings</cite>
</footer>

---

# But still they were quite optimistic ...

> "By 1997, it will be possible to buy 50% of an application as off-the-shelf components, effectively doubling productivity. By 1998, early adopters will be buying 50% of the application as external components and reusing internally generated components for another 25% of the application, effectively doubling productivity on an annual basis"

The Object Technology Architecture: Business Objects for Corporate Information Systems
Business Object Design and Implementation: OOPSLA ’95 Workshop Proceedings

--

# But still OOP is on the rise
* object-oriented COBOL 2002 ISO standard
* ECMAScript 6 with classes

---

# JFYI

Fernandez, David, et al. "Has the Object-Oriented Paradigm Kept Its Promise?." (2002).
APA    
http://ddi.cs.uni-potsdam.de/HyFISCH/Informieren/Programmiersprachen/OOPromisesAndReality.pdf

---
# Functions

> “Sometimes, the elegant implementation is just a function. Not a method. Not a class. Not a framework. Just a function.” – John Carmack

---
# What is a Function?

> In mathematics, a function is a relation between a set of inputs and a set of permissible outputs with the property that each input is related to exactly one output. An example is the function that relates each real number x to its square x2.

--
.left-column[
![](images/191px-Function_machine2.svg.png)
]
--
.right-column[
![:scale 100%](images/function.png)
]
---
# Pure Functions

> A pure function is a function which: Given the same input, will always return the same output. Produces no side effects.

--

> In computer science, a function or expression is said to have a side effect if, in addition to returning a value, it also modifies some state or has an observable interaction with calling functions or the outside world.

---
# Pure Functions

.center[
![:scale 30%](images/function.png)
]
--

What would be the result of: `f(a) -> ???`

--

What we expect: `f(a) -> 2`

--

What we get:

.center[
![:scale 20%](images/Pershing_II_-_4th_test_launch.jpeg)
]

---
# SRP (Single Responsibility Principle)
- Heard about this?
- Apply to the max
  - Functional interface
---

# Functional interfaces (SAM) 
```Java
Label label = new HospitalRecords();
Music music = label.produceWith(new Artist() {
    @Override
*   public String name() {
*       return "Lenzman";
*   }
});
music.play(); // Producing Drum and Bass with famous Lenzman.
```
--
```Java
Label label = new HospitalRecords(); 
*Music music = label.produceWith(() -> "Lenzman");
music.play(); // Producing Drum and Bass with famous Lenzman.
```
---
# Functional interfaces (SAM) 
```Java
public interface Label {
*   Music produceWith(Artist artist);
}
class HospitalRecords implements Label {
    public Music produceWith(Artist artist) {
        return new DrumAndBass(artist);
    }
}
```
--
```Java
*Label label = artist -> new DrumAndBass(artist);
Music music = label.produceWith(() -> "Lenzman");
music.play(); // Producing Drum and Bass with famous Lenzman.
```
--
```Java
*Label label = DrumAndBass::new;
Music music = label.produceWith(() -> "Lenzman");
music.play(); // Producing Drum and Bass with famous Lenzman.
```
--
```Java
*Function<Artist, Music> label = DrumAndBass::new;
Music music = label.apply(() -> "Lenzman");
music.play(); // Producing Drum and Bass with famous Lenzman.
```

---
# Code reuse

How do we reuse code in OOP?

--

> "Favor 'object composition' over 'class inheritance'." (Gang of Four 1995:20)

> "Favor composition over inheritance." (Effective Java, Joshua Bloch 2001)

--

    But how to properly compose classes?

    interface A {
    G doSomeStuff();
    C doSomeOtherStuff();
    }

    interface B {

    }

    How to compose A and B

---
# Function Composition
```Java
Function<A, C> compose(Function<B, C> g, Function<A, B> f) =
    a -> g.apply(f.apply(a));
```

--

![:scale 80%](images/composition.png)

---
# Function Composition - Simple Example
```Java
Function<Integer, Integer> squared = a -> a * a;
Function<Integer, Integer> negated = a -> -a;
*Function<Integer, Integer> squaredAndNegated = negated.compose(squared);
squaredAndNegated.apply(4); // -16
```

--

![:scale 80%](images/math-composition.png)


---
# Function Composition in Java 8
```Java
Function<Artist, Music> writeMusic = Music::new;
Function<Music, Track> recordMusic = Track::new;
*Function<Artist, Track> produceTrack = recordMusic.compose(writeMusic);
```

--

![:scale 80%](images/music-composition.png)


---
# Music production pipeline 
```Java
Function<Artist, Music> writeMusic = Music::new;
Function<Music, Track> recordMusic = Track::new;
Function<List<Track>, Album> publishAlbum = Album::new;

Function<Artist, Track> produceTrack = recordMusic.compose(writeMusic);
*Function<Artist, List<Track>> produceTracks = ???
Function<Artist, Album> produceAlbum = publishAlbum.compose(produceTracks);

Artist someArtist = new Artist("Some Artist");
produceAlbum.apply(someArtist); // And we get the Album in the end
```

---
# High-Order functions
---
# Composition with High-Order functions
show examples not only with streams but also with other things like ComposibleFutures, Options, etc.

# reduce

# map

# filter

# Context

# flatMap
    show examples with streams, ComposibleFutures, Observables, Options

---
# Quiz
What is the size of the this set?
- To Do
---
# Translation of Lambdas
.left-column-20[
## Desugar
]
.right-column-75[
Lambda bodies are lowered to private methods

```Java
public static void main(String[] args){
*   Function<String, String> f = a -> a;
    f.apply("hello");
}
```
```Java
private static String lambda$main$0(String a){
    return a;
}
```
]
---
# Translation of Lambdas
.left-column-20[
## Desugar
## Replace 
]
.right-column-75[
`invokeDynamic` substitutes lambda expression

```Java
Function<String, String> f = 
   indy(MH(metaFactory), MH(invokeVirtual Function.apply), 
        MH(invokeStatic lambda$main$0)());
```
At runtime 
- `metaFactory` used once to create a Factory (`CallSite`) which generates instances of the `Function` interface

- first `MethodHandle` identifies `Function.apply` as the functional interface method to which the lambda is being converted

- second `MethodHandle` identifies `lambda$main$0` as lambda method

JDK8: `CallSite` creates an inner-class-like class (see [`InnerClassLambdaMetafactory`](http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/8-b132/java/lang/invoke/InnerClassLambdaMetafactory.java))
]
---
# Translation of Lambdas
.left-column-20[
## Desugar
## Replace 
## Why
]
.right-column-75[
> In selecting a strategy, there are two competing goals: maximizing flexibility for future optimization by not committing to a specific strategy, vs providing stability in the classfile representation. We can achieve both of these goals by using the invokedynamic feature [...].([Translation of Lambda Expressions](http://cr.openjdk.java.net/~briangoetz/lambda/lambda-translation.html), Brian Goetz 2012)

- `invokeDynamic` shifts Byte Code generation from compile time to run time

- Depending on the context different translation strategies may be used

- Translation of Lambdas can easily profit from new JVM features (cf. value types)
]
---
# Translation of Lambdas
.left-column-20[
## Desugar
## Replace 
## Why
## Perfomance
]
.right-column-75[
### Google Results: java 8 lambda performance

- Java 8 lambda performance is not great

- How Java 8 Lambdas and Streams Can Make Your Code 5 Times slower

- Big execution time difference between java Lambda vs Anonymous class

]
---
# Translation of Lambdas
.left-column-20[
## Desugar
## Replace 
## Why
## Perfomance
]
.right-column-75[
### Lambda expressions vs. data structures 
- Lambda expressions are on par and most often better than compareable imparative constructs [[1]](http://worldcomp-proceedings.com/proc/p2015/SER2509.pdf) 

- Due to advanced implementation techniques lambda expressions are much faster compared to same constrcuts in Scala or C#/F# [[2]](http://cgi.di.uoa.gr/~biboudis/clashofthelambdas.pdf)

- There is no runtime optimizaton for `Stream`s resulting in lower parallel perfomance compared to optimized constructs in Scala or C#/F# [[2]](http://cgi.di.uoa.gr/~biboudis/clashofthelambdas.pdf)

- Sequential streams are not faster than loops. Parallel streams may not be faster than sequential streams (cf. initialization costs). [[3]](https://jaxenter.com/java-performance-tutorial-how-fast-are-the-java-8-streams-118830.html)

]
        </textarea>
        <script src="remark-latest.min.js">
        </script>
        <script>
            remark.macros.scale = function (percentage) {
  var url = this;
  return '<img src="' + url + '" style="width: ' + percentage + '" />';
};
                var slideshow = remark.create({
                   highlightLines: true
                });
        </script>
    </body>
</html>
